<form class="{{cssClass}} item-sheet transformation" autocomplete="off">
    <script>
        if (typeof inputs === 'undefined') {
            var inputs = document.querySelectorAll('input:not([type="checkbox"])');
        }
        inputs.forEach(input => {
            input.setAttribute('onkeydown', 'if (event.keyCode === 13) { this.blur(); }');
        });
    </script>
    <header class="sheet-header">
        <div class="sheet-header-1">
            <img class="profile-img" src="{{data.img}}" data-edit="img" title="{{data.name}}"/>
            <textarea type="text" name="system.name" value="{{data.system.name}}" placeholder="{{localize "FI.TransformationSheet.Name"}}">{{data.system.name}}</textarea>
        </div>
    </header>
    
    {{!-- Sheet Body --}}
    <main class="sheet-body">
        <table class="sheet-main">
            <tr class="top">
                <td class="transformationType" colspan="2">
                    <label>{{localize "FI.TransformationSheet.TransformationType"}}</label>
                    <div class="transformationTypeDiv" title="{{localize "FI.TransformationSheet.TransformationType"}}">
                        <i class="fas fa-magic"></i>
                        <input type="text" name="system.transformationType" value="{{data.system.transformationType}}" list="transformationTypes" title="{{localize "FI.TransformationSheet.TransformationType"}}"/>
                        <script>
                            var descriptionButton = document.createElement('i');
                            var transformationTypeList = document.querySelector('#transformationTypes');
                            var translatedTransformationTypes = [];
                            for (let i = 0; i < transformationTypeList.options.length; i++) {
                                translatedTransformationTypes.push(game.i18n.localize(`FI.TransformationType.${transformationTypeList.options[i].title}`));
                            }
                            descriptionButton.classList.add('fas', 'fa-regular', 'fa-circle-question');
                            descriptionButton.title = '';
                            descriptionButton.addEventListener('mouseover', () => {
                                const transformationType = document.querySelector('input[name="system.transformationType"]').value;
                                if (translatedTransformationTypes.includes(transformationType)) {
                                    const title = transformationTypeList.querySelector(`option[value="${transformationType}"]`).title;
                                    const description = game.i18n.localize(`FI.TransformationType.Label.${title}`);
                                    descriptionButton.title = description;
                                } else {
                                    descriptionButton.title = game.i18n.localize('FI.TransformationType.Label.Custom');
                                }
                            });
                            document.querySelector('.transformationTypeDiv').appendChild(descriptionButton);
                        </script>
                        <datalist id="transformationTypes">
                            <option value="{{localize "FI.TransformationType.Elemental"}}" title="Elemental"/>
                            <option value="{{localize "FI.TransformationType.Racial"}}" title="Racial"/>
                            <option value="{{localize "FI.TransformationType.Class"}}" title="Class"/>
                        </datalist>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="MPCost">
                    <label>{{localize "FI.TransformationSheet.MPCost"}}</label>
                    <input type="number" name="system.mpCost" value="{{data.system.mpCost}}" title="{{localize "FI.TransformationSheet.MPCost"}}"/>
                    <label>{{localize "FI.System.MP"}}</label>
                </td>
                <td class="SPCost">
                    <label>{{localize "FI.TransformationSheet.SPCost"}}</label>
                    <input type="number" name="system.spCost" value="{{data.system.spCost}}" title="{{localize "FI.TransformationSheet.SPCost"}}"/>
                    <label>{{localize "FI.System.SP"}}</label>
                </td>
            </tr>
            <tr>
                <td class="HPCost">
                    <label>{{localize "FI.TransformationSheet.HPCost"}}</label>
                    <input type="number" name="system.hpCost" value="{{data.system.hpCost}}" title="{{localize "FI.TransformationSheet.HPCost"}}"/>
                    <label>{{localize "FI.System.HP"}}</label>
                </td>
                <td class="otherCost">
                    <label>{{localize "FI.TransformationSheet.OtherCost"}}</label>
                    <input type="text" name="system.otherCost" value="{{data.system.otherCost}}" title="{{localize "FI.TransformationSheet.OtherCost"}}"/>
                </td>
            </tr>
            <tr>
                <td class="stat">
                    <label>{{localize "FI.Stat.Label"}}</label>
                    <select name="system.stat" value="{{data.system.stat}}">
                        <option value="">{{localize "FI.Stat.None"}}</option>
                        <option value="STR">{{localize "FI.Stat.STR"}}</option>
                        <option value="DEX">{{localize "FI.Stat.DEX"}}</option>
                        <option value="CON">{{localize "FI.Stat.CON"}}</option>
                        <option value="INT">{{localize "FI.Stat.INT"}}</option>
                        <option value="WIS">{{localize "FI.Stat.WIS"}}</option>
                        <option value="CHA">{{localize "FI.Stat.CHA"}}</option>
                        <option value="LUK">{{localize "FI.Stat.LUK"}}</option>
                        <option value="WIL">{{localize "FI.Stat.WIL"}}</option>
                        <option value="HON">{{localize "FI.Stat.HON"}}</option>
                        <script>
                            document.querySelector('select[name="system.stat"]').value = '{{data.system.stat}}';
                        </script>
                    </select>
                </td>
                <td class="value">
                    <label>{{localize "FI.System.Value"}}</label>
                    <input type="text" name="system.value" value="{{data.system.value}}"/>
                </td>
            </tr>
        </table>
        <section class="sheet-description">
            <label>{{localize "FI.TransformationSheet.Description"}}</label>
            <textarea class="richTextArea" name="system.description">{{data.system.description}}</textarea>
        </section>
    </main>
</form>

<script>
    // TinyMCE init
    tinymce.init({
        selector: '.richTextArea',
        menubar: false,
        toolbar: 'bold italic underline forecolor backcolor | fontfamily fontsize | alignleft aligncenter alignright alignjustify | bullist outdent indent | undo redo | removeformat',
        plugins: 'lists',
        min_height: 150,
        height: 150,
        setup: function (editor) {
            editor.on('change', function () {
                editor.save();
            });
        }
    });
</script>